Index: twisted/web2/dav/test/test_resource.py
===================================================================
--- twisted/web2/dav/test/test_resource.py	(revision 18545)
+++ twisted/web2/dav/test/test_resource.py	(working copy)
@@ -282,7 +282,8 @@
         # Has auth; should allow
 
         request = SimpleRequest(site, "GET", "/")
-        request.user = davxml.Principal(davxml.HRef("/users/d00d"))
+        request.authnUser = davxml.Principal(davxml.HRef("/users/d00d"))
+        request.authzUser = davxml.Principal(davxml.HRef("/users/d00d"))
         d = request.locateResource('/')
         d.addCallback(_checkPrivileges)
         d.addCallback(expectOK)
@@ -380,8 +381,8 @@
         return succeed(davPrivilegeSet)
 
     def currentPrincipal(self, request):
-        if hasattr(request, "user"):
-            return request.user
+        if hasattr(request, "authzUser"):
+            return request.authzUser
         else:
             return davxml.Principal(davxml.Unauthenticated())
 
@@ -400,6 +401,8 @@
     def accessControlList(self, request, **kwargs):
         return succeed(self.acl)
     
+    def principalForUser(self, user):
+        return self.children[user]
 
 class AuthAllResource (TestResource):
     """Give Authenticated principals all privileges deny everything else
@@ -414,3 +417,6 @@
 class TestDAVPrincipalResource(DAVPrincipalResource, TestResource):
     """Get deadProperties from TestResource
     """
+
+    def principalURL(self):
+        return self.uri

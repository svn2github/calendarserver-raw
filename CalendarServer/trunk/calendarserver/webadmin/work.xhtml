<!DOCTYPE html>
<html
 xmlns:t="http://twistedmatrix.com/ns/twisted.web.template/0.1"
 t:render="main"
>

  <head>

    <title><t:slot name="title" /></title>
    <link t:render="stylesheet" />

    <style>

    #work_queues_chart rect {
      fill: steelblue;
    }

    #work_queues_chart text {
      fill: white;
      font: 10px sans-serif;
      text-anchor: end;
    }

    </style>

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script>

      function drawChart(data) {
        var width = 600;
        var barHeight = 20;

        var scaledWidth =
          d3.scale.linear()
            .domain([0, d3.max(data)])
            .range([0, width]);

        var chart =
          d3.select("#work_queues_chart")
            .attr("width", width)
            .attr("height", barHeight * data.length);

        var bars =
          chart.selectAll("g")
            .data(data)

        // Enter selection
        bars.enter().append("g")

        // Update selection
        bars.attr(
          "transform",
          function(d, i) { return "translate(0," + i * barHeight + ")"; }
        );

        bars.append("rect")
          .attr("width", scaledWidth)
          .attr("height", barHeight - 1);

        bars.append("text")
          .attr("x", function(d) { return scaledWidth(d) - 3; })
          .attr("y", barHeight / 2)
          .attr("dy", "0.35em")
          .text(function(d) { return d; });

        // Exit selection
        bars.exit().remove()
      }

      function updateChart() {
        drawChart([4, 8, 15, 16, 23, 42]);
      }

      function initChart() {
        drawChart([1, 2, 3, 4, 8, 15, 16, 23, 42]);
      }


      function initEventSource() {
        var eventSource = new EventSource("./events");
      }


      window.onload = function() {
        initChart();
      };

    </script>

  </head>

  <body>

    <h1><t:slot name="title" /></h1>

    <svg id="work_queues_chart" />
    <br />
    <button onclick="updateChart()">Update</button>

  </body>

</html>

<!DOCTYPE html>
<html xmlns:t="http://twistedmatrix.com/ns/twisted.web.template/0.1" t:render="main">

  <head>
    <title><t:slot name="title" /></title>
    <link t:render="stylesheet" />

    <script type="text/javascript">

      window.onload = function() {
        var eventSource = new EventSource("./events");

        var accessStatusElement = document.getElementById("access-log-status");
        var accessLogElement = document.getElementById("access-log");

        accessStatusElement.innerHTML = "Connecting...";

        eventSource.addEventListener(
          "open",
          function(e) {
            accessStatusElement.innerHTML = "Connected.";
          },
          false
        );

        eventSource.addEventListener(
          "error",
          function(e) {
            if (e.readyState == EventSource.CLOSED) {
              accessStatusElement.innerHTML = "Conneciton closed.";
            }
            else {
              accessStatusElement.innerHTML = "Polling...";
            }
          },
          false
        );

        eventSource.addEventListener(
          "access",
          function(e) {
            // Append text
            accessLogElement.innerHTML += event.data + "<br />";

            // Scroll to bottom
            accessLogElement.scrollTop = accessLogElement.scrollHeight;
          },
          false
        );
      }

    </script>

    <style>
      .log {
        width: 100%;
        height: 150pt;
        overflow: scroll;
        border: 1px solid;
        font-family: monospace;
        font-size: 0.75em;
      }
    </style>
  </head>

  <body>

    <h1><t:slot name="title" /></h1>

    <h2>Access Log</h2>

    <div id="access-log-status" />
    <div id="access-log" class="log" />

    <h2>Server Log</h2>

    <div id="server-log-status" />
    <div id="server-log" class="log" />

  </body>

</html>
